!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Hookman=e():t.Hookman=e()}(this,(function(){return(()=>{"use strict";var t={496:function(t,e){var r,n,o=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},s=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},c=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t},l=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.Hookman=e.WSError=e.HOOKMAN_EVENTS=void 0,function(t){t.CONNECT="connect",t.DISCONNECT="disconnect",t.MESSAGE="message",t.ERROR="error"}(n=e.HOOKMAN_EVENTS||(e.HOOKMAN_EVENTS={}));var u=function(t){function e(e){var r=t.call(this)||this;return r.event=e,r}return o(e,t),e}(Error);e.WSError=u;var d=function(){function t(t){this.base_url="ws://websocket.hookman.ng",this.EVENTS=n,this._api_key=t,this._topicHandlers=new Map,this._generalHandlers=new Map}return t.prototype.init=function(){var t=this;this._socket=new WebSocket(this.base_url),this._socket.onopen=function(){var e={id:"auth",type:"auth",key:t._api_key};t._socket.send(JSON.stringify(e))},this._socket.onclose=function(e){t.dispatchEvent(n.DISCONNECT,e)},this._socket.onerror=function(e){t.dispatchError(new u(e))},this._socket.onmessage=function(e){try{var r=JSON.parse(String(e.data));switch(r.type){case"auth":if(!1===r.ack&&!0===r.error)t.dispatchError(new Error(r.error_message));else{var o=r.client_token;t.dispatchEvent(n.CONNECT,{client_token:o})}break;case"event":var i=r.payload;if(r.channel){var a=r.channel;if(t._topicHandlers.has(a)){var s=t._topicHandlers.get(a);return s?void t.processSetOfhandlers(s,i):void t.dispatchError(new Error("internal: undefined topichandlerSet"))}}t.dispatchEvent(n.MESSAGE,i);break;case"broadcast":!0===r.broadcast?console.log("broadcasts enabled"):console.log("boradcasts disabled")}}catch(e){t.dispatchError(e)}}},t.prototype.addEventListener=function(t,e){if(this._generalHandlers.has(t)){var r=this._generalHandlers.get(t);if(!r)return;if(r.has(e))return;r.add(e)}else{var n=new Set;n.add(e),this._generalHandlers.set(t,n)}},t.prototype.removeEventListener=function(t,e){if(this._generalHandlers.has(t)){var r=this._generalHandlers.get(t);if(!r)return;r.has(e)&&r.delete(e)}},t.prototype.on=function(t,e){this.addEventListener(t,e)},t.prototype.off=function(t,e){this.removeEventListener(t,e)},t.prototype.publish=function(t,e){this.send(e,void 0,t)},t.prototype.subscribe=function(t,e){if(this._topicHandlers.has(t)){var r=this._topicHandlers.get(t);if(!r)return void this.dispatchError(new Error("internal: undefined topichandlerSet"));if(r.has(e))return;r.add(e)}else{var n=new Set;n.add(e),this._topicHandlers.set(t,n);var o={id:1e3*Math.random(),type:"listen",channel:t};this._socket.send(JSON.stringify(o))}},t.prototype.unsubscribe=function(t,e){if(this._topicHandlers.has(t)){var r=this._topicHandlers.get(t);if(!r)return void this.dispatchError(new Error("internal: undefined topichandlerSet"));if(r.has(e)&&r.delete(e),0===r.size){var n={id:1e3*Math.random(),type:"unlisten",channel:t};this._socket.send(JSON.stringify(n))}}},t.prototype.broadcast=function(t){this.send(t)},t.prototype.receiveBroadcastOn=function(){var t={id:1e3*Math.random(),type:"broadcast",broadcast:!0};this._socket.send(JSON.stringify(t))},t.prototype.receiveBroadcastOff=function(){var t={id:1e3*Math.random(),type:"broadcast",broadcast:!1};this._socket.send(JSON.stringify(t))},t.prototype.dispatchEvent=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this._generalHandlers.get(t);n&&this.processSetOfhandlers.apply(this,c([n],e))},t.prototype.dispatchError=function(t){var e=this._generalHandlers.get(n.ERROR);e&&this.processSetOfhandlers(e,t)},t.prototype.processSetOfhandlers=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return i(this,void 0,void 0,(function(){var r,n,o,i,s;return a(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,6,7]),r=l(t),n=r.next(),a.label=1;case 1:return n.done?[3,4]:[4,n.value.apply(void 0,c(e))];case 2:a.sent(),a.label=3;case 3:return n=r.next(),[3,1];case 4:return[3,7];case 5:return o=a.sent(),i={error:o},[3,7];case 6:try{n&&!n.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}return[7];case 7:return[2]}}))}))},t.prototype.sendToClientToken=function(t,e){this.send(t,e)},t.prototype.close=function(){this._socket.close()},t.prototype.send=function(t,e,r){var n={id:1e3*Math.random(),type:"ccast",payload:t};e&&(n.client_token=e),r&&(n.channel=r);try{var o=JSON.stringify(n);this._socket.send(o)}catch(t){this.dispatchError(t)}},t}();e.Hookman=d},607:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=r(496);t.exports=n.Hookman}},e={};return function r(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}(607)})()}));